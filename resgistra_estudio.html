<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registrar Resultado de Estudio - Clínica Endocrinología</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-blue: #2e4a80;
      --light-blue: #7ca6e2;
      --dark-blue: #1c5085;
      --accent-blue: #4d63b1;
      --text-dark: #2e4a80;
      --text-dark2: #ffffff;
      --text-light: #5f6368;
      --border-light: #dadce0;
    }

    body {
      font-family: "Montserrat", sans-serif;
      font-optical-sizing: auto;
      font-weight: 300;
      font-style: normal;
      background-color: hsl(0, 0%, 100%);
      background-image: radial-gradient(800px circle at 100% 0%,
          hsl(211, 58%, 92%) 15%,
          hsl(210, 86%, 97%) 35%,
          hsl(223, 91%, 95%) 75%,
          hsl(214, 100%, 99%) 80%,
          transparent 100%),
          radial-gradient(600px circle at 0% 100%,
            hsl(202, 46%, 92%) 15%,
            hsl(0, 0%, 100%) 35%,
            hsl(210, 100%, 96%) 75%,
            hsl(216, 100%, 99%) 80%,
            transparent 100%);
      min-height: 100vh;
      padding: 20px;
    }

    h1, h3, h4, h5, h6 {
      font-family: "DM Sans", sans-serif;
      color: var(--text-dark);
    }

    h2{
      font-family: "DM Sans", sans-serif;
      color: var(--text-dark2);
    }

    .form-container { 
      max-width: 800px; 
      margin: 2rem auto; 
    }

    .result-form { 
      background: white; 
      border-radius: 16px; 
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); 
      border: 1px solid var(--border-light); 
      overflow: hidden; 
    }

    .form-header { 
      background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue)); 
      color: white; 
      padding: 2rem; 
      text-align: center;
    }

    .form-header h2 { 
      margin: 0; 
      font-weight: 700; 
      font-family: "DM Sans", sans-serif;
    }

    .form-header p { 
      opacity: 0.9; 
      margin: 0.5rem 0 0 0; 
      font-weight: 300;
    }

    .form-body { 
      padding: 2rem; 
    }

    .form-label { 
      font-weight: 600; 
      color: var(--text-dark); 
      margin-bottom: 0.5rem; 
      font-size: 0.95rem;
      font-family: "Montserrat", sans-serif;
    }

    .form-control, textarea { 
      border-radius: 10px; 
      border: 2px solid var(--border-light); 
      padding: 0.75rem 1rem; 
      transition: all 0.3s ease;
      font-family: "Montserrat", sans-serif;
    }

    .form-control:focus, textarea:focus { 
      border-color: var(--primary-blue); 
      box-shadow: 0 0 0 3px rgba(46, 74, 128, 0.1);
      transform: translateY(-1px);
    }

    .btn-primary {
      background: linear-gradient(to right, #7ca6e2, #4763b8);
      border: none;
      border-radius: 25px;
      padding: 0.75rem 2rem;
      font-weight: 600;
      font-family: "DM Sans", sans-serif;
      transition: transform 0.2s ease-in-out;
    }

    .btn-primary:hover {
      transform: scale(1.05);
      background: linear-gradient(to right, #6a96d0, #3a53a0);
    }

    .btn-outline-secondary {
      border: 2px solid var(--text-light);
      color: var(--text-light);
      border-radius: 25px;
      padding: 0.75rem 2rem;
      font-weight: 600;
      font-family: "DM Sans", sans-serif;
      transition: all 0.3s ease;
    }

    .btn-outline-secondary:hover {
      background: var(--text-light);
      color: white;
      transform: scale(1.05);
    }

    .alert-info {
      background: linear-gradient(135deg, #e8f0fe, #d2e3fc);
      border: 1px solid var(--primary-blue);
      border-left: 4px solid var(--primary-blue);
      border-radius: 10px;
      color: var(--text-dark);
    }

    .text-info {
      color: var(--primary-blue) !important;
    }

    .badge {
      font-family: "Montserrat", sans-serif;
      font-weight: 600;
      border-radius: 12px;
      padding: 0.4rem 0.8rem;
    }

    .bg-info {
      background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue)) !important;
    }

    .invalid-feedback {
      color: #dc3545;
      font-size: 0.875rem;
      font-family: "Montserrat", sans-serif;
    }

    .needs-validation .form-control:invalid,
    .needs-validation textarea:invalid {
      border-color: #dc3545;
    }

    .needs-validation .form-control:valid,
    .needs-validation textarea:valid {
      border-color: #198754;
    }

    .border-top {
      border-top: 1px solid var(--border-light) !important;
    }

    @media (max-width: 768px) {
      .form-body { 
        padding: 1.5rem; 
      }
      .form-container {
        margin: 1rem auto;
      }
      body {
        padding: 10px;
      }
      .d-flex {
        flex-direction: column;
        gap: 1rem !important;
      }
      .btn-primary, .btn-outline-secondary {
        width: 100%;
      }
    }
  </style>
</head>
<body>

<div class="form-container">
  <div class="result-form">
    <div class="form-header">
      <h2><i class="fas fa-file-medical-alt me-2"></i>Registrar Resultado de Estudio</h2>
      <p>Complete los datos del estudio realizado</p>
    </div>

    <!-- Información del paciente y solicitud -->
    <div class="alert alert-info mx-3 mt-3">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h5 class="mb-1 text-info">Carlos Rodríguez García</h5>
          <p class="mb-0">ID: P-001 | Solicitud: SOL-1005 | Consulta: #1001</p>
        </div>
        <div class="col-md-4 text-md-end">
          <span class="badge bg-info fs-6">Resultado Nuevo</span>
        </div>
      </div>
    </div>

    <form class="form-body needs-validation" id="resultForm" novalidate>
      <!-- Campos ocultos de IDs -->
      <input type="hidden" name="ID_RESULTADO" value="RES-5001">
      <input type="hidden" name="ID_CONSULTA" value="1001">
      <input type="hidden" name="ID_SOLICITUD" value="SOL-1005">

      <div class="mb-3">
        <label class="form-label">Fecha de Estudio *</label>
        <input type="date" class="form-control" name="FECHA_ESTUDIO" value="2025-09-22" required>
        <div class="invalid-feedback">Ingrese la fecha del estudio.</div>
      </div>

      <div class="mb-3">
        <label class="form-label">Laboratorio Externo *</label>
        <input type="text" class="form-control" name="LABORATORIO_EXTERNO" value="Laboratorio Central" required>
        <div class="invalid-feedback">Ingrese el nombre del laboratorio.</div>
      </div>

      <div class="mb-3">
        <label class="form-label">Interpretación Textual *</label>
        <textarea class="form-control" rows="4" name="INTERPRETACION_TEXTUAL" required>Resultados dentro de parámetros normales. Glucosa y perfil tiroideo estables.</textarea>
        <div class="invalid-feedback">La interpretación textual es obligatoria.</div>
      </div>

      <div class="mb-3">
        <label class="form-label">Valores Numéricos *</label>
        <textarea class="form-control" rows="4" name="VALORES_NUMERICOS" required>Glucosa: 95 mg/dL
TSH: 2.1 μUI/mL
T4 libre: 1.1 ng/dL
Colesterol total: 180 mg/dL
HDL: 55 mg/dL
LDL: 100 mg/dL</textarea>
        <div class="invalid-feedback">Ingrese los valores numéricos (o indique N/A si aplica).</div>
      </div>

      <div class="d-flex justify-content-end gap-3 pt-3 border-top">
        <!-- Cancelar: redirige a detalle_paciente.html -->
        <button type="button" id="cancelBtn" class="btn btn-outline-secondary">
          <i class="fas fa-times me-2"></i>Cancelar
        </button>

        <!-- Guardar: valida, anima y redirige -->
        <button type="submit" id="saveBtn" class="btn btn-primary">
          <i class="fas fa-save me-2"></i>Guardar Resultado
        </button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  (function() {
    'use strict';

    const REDIRECT_URL = 'detalle_paciente.html';
    const REDIRECT_DELAY_MS = 1200; // animación corta

    const form = document.getElementById('resultForm');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');

    // Cancelar -> redirigir inmediatamente
    cancelBtn.addEventListener('click', () => {
      window.location.href = REDIRECT_URL;
    });

    // Envío con validación
    form.addEventListener('submit', function(event) {
      event.preventDefault();
      event.stopPropagation();

      // Forzar validación de todos los campos
      if (!form.checkValidity()) {
        form.classList.add('was-validated');
        // No sigue el envío si hay campos inválidos
        return;
      }

      // Si es válido: animación corta y redirección
      const originalHTML = saveBtn.innerHTML;
      saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Guardando...';
      saveBtn.disabled = true;

      setTimeout(() => {
        // Redirige después de la animación corta
        alert('Resultado de estudio guardado exitosamente.');
        window.location.href = REDIRECT_URL;
      }, REDIRECT_DELAY_MS);
    }, false);
  })();
</script>

</body>
</html>