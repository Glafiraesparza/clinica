<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salud Integral - Secretaría</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    
    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="secretaria2.css">
    
    <!-- Estilos personalizados -->
</head>
<body>
    <!-- Navbar mejorada de Bootstrap -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">
                <i class="fas fa-heartbeat me-2"></i>SALUD INTEGRAL
            </a>
            
            <!-- Botón para móviles -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <!-- Elementos del menú -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('index')">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('calendario')">Calendario</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('agendarcita')">Agendar Cita</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('pacientes')">Pacientes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('citas')">Gestión de Citas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Salir</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="#">
                            <i class="fas fa-bell"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">3</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenido dinámico basado en la página actual -->
    <div id="page-content">
        <!-- El contenido se cargará aquí dinámicamente -->
    </div>

    <!-- Footer -->
    <footer class="py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="fas fa-heartbeat me-2"></i>Salud Integral</h5>
                    <p>Sistema de gestión de consultorio médico</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">&copy; 2024 Salud Integral. Todos los derechos reservados.</p>
                    <p class="mb-0">Proyecto Universitario</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/es.min.js"></script>
    
    <!-- Script personalizado -->
    <script>
        // Datos de ejemplo para las citas
        const sampleAppointments = [
            {
                id: 1,
                title: 'Juan Pérez - Consulta',
                start: new Date(new Date().setHours(10, 0, 0, 0)),
                end: new Date(new Date().setHours(10, 30, 0, 0)),
                doctor: 'Dr. Martínez',
                type: 'Consulta general',
                status: 'confirmada'
            },
            {
                id: 2,
                title: 'María González - Control',
                start: new Date(new Date().setHours(11, 15, 0, 0)),
                end: new Date(new Date().setHours(11, 45, 0, 0)),
                doctor: 'Dra. Fernández',
                type: 'Control postoperatorio',
                status: 'pendiente'
            },
            {
                id: 3,
                title: 'Carlos Ruiz - Revisión',
                start: new Date(new Date().setHours(14, 30, 0, 0)),
                end: new Date(new Date().setHours(15, 0, 0, 0)),
                doctor: 'Dr. Martínez',
                type: 'Revisión de análisis',
                status: 'confirmada'
            }
        ];

            const appointmentHistory = [
    {
        id: 101,
        title: 'Juan Pérez - Consulta',
        start: new Date(new Date().setDate(new Date().getDate() - 5)),
        end: new Date(new Date().setDate(new Date().getDate() - 5)),
        doctor: 'Dr. Martínez',
        type: 'Consulta general',
        status: 'completada',
        costo: 500
    },
    {
        id: 102,
        title: 'María González - Control',
        start: new Date(new Date().setDate(new Date().getDate() - 3)),
        end: new Date(new Date().setDate(new Date().getDate() - 3)),
        doctor: 'Dra. Fernández',
        type: 'Control postoperatorio',
        status: 'completada',
        costo: 700
    },
    {
        id: 103,
        title: 'Carlos Ruiz - Revisión',
        start: new Date(new Date().setDate(new Date().getDate() - 1)),
        end: new Date(new Date().setDate(new Date().getDate() - 1)),
        doctor: 'Dr. Martínez',
        type: 'Revisión de análisis',
        status: 'completada',
        costo: 500
    },
    // AGREGAR ESTAS NUEVAS CITAS:
    {
        id: 104,
        title: 'Ana López - Consulta',
        start: new Date(new Date().setDate(new Date().getDate() - 7)),
        end: new Date(new Date().setDate(new Date().getDate() - 7)),
        doctor: 'Dra. Fernández',
        type: 'Consulta de seguimiento',
        status: 'completada',
        costo: 700
    },
    {
        id: 105,
        title: 'Pedro Sánchez - Urgencia',
        start: new Date(new Date().setDate(new Date().getDate() - 2)),
        end: new Date(new Date().setDate(new Date().getDate() - 2)),
        doctor: 'Dr. García',
        type: 'Consulta de urgencia',
        status: 'completada',
        costo: 600
    },
    {
        id: 106,
        title: 'Laura Mendoza - Control',
        start: new Date(new Date().setDate(new Date().getDate() - 4)),
        end: new Date(new Date().setDate(new Date().getDate() - 4)),
        doctor: 'Dr. Martínez',
        type: 'Control rutinario',
        status: 'completada',
        costo: 500
    }
];
        // Precios fijos por doctor
        const doctorPrices = {
            'Dr. Martínez': 500,
            'Dra. Fernández': 700,
            'Dr. García': 600
        };

        // Actualiza los datos de pacientes con más información
        const samplePatients = [
            { 
                id: 1, 
                name: 'Juan Pérez Rodríguez', 
                phone: '555-1234', 
                email: 'juan@email.com',
                birthdate: '1985-03-15',
                alergias: null,
                citas: 5,
                ultimaCita: '2024-05-20'
            },
            { 
                id: 2, 
                name: 'María González López', 
                phone: '555-5678', 
                email: 'maria@email.com',
                birthdate: '1990-07-22',
                alergias: null,
                citas: 3,
                ultimaCita: '2024-05-25'
            },
            { 
                id: 3, 
                name: 'Carlos Ruiz Hernández', 
                phone: '555-9012', 
                email: 'carlos@email.com',
                birthdate: '1978-11-30',
                alergias: null,
                citas: 8,
                ultimaCita: '2024-05-28'
            },
            { 
                id: 4, 
                name: 'Ana Martínez Silva', 
                phone: '555-3456', 
                email: 'ana@email.com',
                birthdate: '1995-01-10',
                alergias: null,
                citas: 2,
                ultimaCita: '2024-05-15'
            },
            { 
                id: 5, 
                name: 'Pedro Sánchez Díaz', 
                phone: '555-7890', 
                email: 'pedro@email.com',
                birthdate: '1982-09-05',
                alergias: null,
                citas: 6,
                ultimaCita: '2024-05-22'
            }
        ];

        // Funcionalidad de enrutamiento simple
        function loadPage(page) {
            const content = document.getElementById('page-content');
            
            // Actualizar navegación activa
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === page + '.html') {
                    link.classList.add('active');
                }
            });
            
            switch(page) {
                case 'index':
                    content.innerHTML = getHomePage();
                    break;
                case 'calendario':
                    content.innerHTML = getCalendarPage();
                    setTimeout(initCalendar, 100);
                    break;
                case 'agendarcita':
                    content.innerHTML = getAppointmentPage();
                    setTimeout(initAppointmentForm, 100);
                    break;
                case 'pacientes':
                    content.innerHTML = getPacientesPage();
                    break;
                case 'citas':
                    content.innerHTML = getCitasPage();
                    setTimeout(initCitasCalendar, 100);
                    break;
                case 'historial':
                    content.innerHTML = getHistorialPage();
                    break;
                default:
                    content.innerHTML = getHomePage();
            }
        }

        // Página de Inicio
        function getHomePage() {
            return `
                <!-- Sección de Accesos Directos -->
                <section class="container mb-5">
                    <h2 class="text-center section-title mb-5">Módulo Recepcionista</h2>
                    
                    <div class="row g-4">
                        
                        <div class="col-md-6 col-lg-3">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center p-4">
                                    <i class="bi bi-calendar-plus text-primary d-block mb-3" style="font-size: 56px;"></i>
                                    <h4 class="card-title mb-3">Agendar Cita</h4>
                                    <p class="card-text">Programa una nueva cita para un paciente existente o nuevo.</p>
                                    <a href="#" onclick="loadPage('agendarcita')" class="btn btn-primary rounded-pill mt-auto">
                                        Acceder <i class="bi bi-arrow-right-short"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-3">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center p-4">
                                    <i class="bi bi-people text-primary d-block mb-3" style="font-size: 56px;"></i>
                                    <h4 class="card-title mb-3">Gestión de Pacientes</h4>
                                    <p class="card-text">Administra la información de los pacientes del consultorio.</p>
                                    <a href="#" onclick="loadPage('pacientes')" class="btn btn-primary rounded-pill mt-auto">
                                        Acceder <i class="bi bi-arrow-right-short"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-3">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center p-4">
                                    <i class="bi bi-clipboard-data text-primary d-block mb-3" style="font-size: 56px;"></i>
                                    <h4 class="card-title mb-3">Gestión de citas</h4>
                                    <p class="card-text">Confirma, cancela y gestiona las citas pendientes.</p>
                                    <a href="#" onclick="loadPage('citas')" class="btn btn-primary rounded-pill mt-auto">
                                        Acceder <i class="bi bi-arrow-right-short"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 col-lg-3">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center p-4">
                                    <i class="bi bi-clock-history text-primary d-block mb-3" style="font-size: 56px;"></i>
                                    <h4 class="card-title mb-3">Historial de Citas</h4>
                                    <p class="card-text">Revisa el historial de citas y los ingresos por doctor.</p>
                                    <a href="#" onclick="loadPage('historial')" class="btn btn-primary rounded-pill mt-auto">
                                        Acceder <i class="bi bi-arrow-right-short"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Resumen rápido del día -->
                <section class="container mb-5">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="today-appointments p-4">
                                <h3 class="section-title">Citas de Hoy</h3>
                                
                                ${sampleAppointments.map(appointment => `
                                    <div class="appointment-item">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h5 class="mb-1">${appointment.title.split(' - ')[0]}</h5>
                                                <p class="mb-1">${appointment.type} - ${appointment.doctor}</p>
                                                <small class="text-muted"><i class="far fa-clock me-1"></i>${appointment.start.getHours()}:${appointment.start.getMinutes().toString().padStart(2, '0')} - ${appointment.end.getHours()}:${appointment.end.getMinutes().toString().padStart(2, '0')}</small>
                                            </div>
                                            <span class="badge ${appointment.status === 'confirmada' ? 'bg-success' : 'bg-warning text-dark'}">${appointment.status === 'confirmada' ? 'Confirmada' : 'Pendiente'}</span>
                                        </div>
                                    </div>
                                `).join('')}
                                
                                <div class="text-end mt-3">
                                    <a href="#" onclick="loadPage('calendario')" class="btn btn-outline-primary">Ver Calendario Completo</a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="row">
                                <div class="col-12">
                                    <div class="stat-card">
                                        <i class="fas fa-calendar-check text-primary mb-3" style="font-size: 2.5rem;"></i>
                                        <h3 class="stat-number">12</h3>
                                        <p class="text-muted">Citas esta semana</p>
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <div class="stat-card">
                                        <i class="fas fa-user-injured text-primary mb-3" style="font-size: 2.5rem;"></i>
                                        <h3 class="stat-number">${sampleAppointments.length}</h3>
                                        <p class="text-muted">Pacientes hoy</p>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        // Página de Calendario
        function getCalendarPage() {
            return `
                <section class="container mt-4">
                    <div class="row">
                        <div class="col-12">
                            <h1 class="section-title">Calendario de Citas</h1>
                            <p class="lead">Gestiona y visualiza todas las citas programadas del consultorio.</p>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="calendar-container">
                                <div id="calendar"></div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="appointment-details">
                                <h4><i class="fas fa-info-circle me-2"></i>Detalles de la Cita</h4>
                                <div id="appointment-detail-content">
                                    <p class="text-muted">Selecciona una cita del calendario para ver los detalles.</p>
                                </div>
                                
                                <div class="mt-4">
                                    <h5><i class="fas fa-filter me-2"></i>Filtros</h5>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="filter-confirmed" checked>
                                        <label class="form-check-label" for="filter-confirmed">
                                            Confirmadas
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="filter-pending" checked>
                                        <label class="form-check-label" for="filter-pending">
                                            Pendientes
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="filter-urgent" checked>
                                        <label class="form-check-label" for="filter-urgent">
                                            Urgentes
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <a href="#" onclick="loadPage('agendarcita')" class="btn btn-primary w-100">
                                        <i class="fas fa-plus me-2"></i>Agendar Nueva Cita
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        // Página de Agendar Cita
        function getAppointmentPage() {
            return `
                <section class="container mt-4">
                    <div class="row">
                        <div class="col-12">
                            <h1 class="section-title">Agendar Nueva Cita</h1>
                        </div>
                    </div>
                    
                    <div class="row justify-content-center">
                        <div class="col-lg-10">
                            <div class="form-container">
                                <form id="appointment-form">
                                    
                                    <!-- Sección de Cita -->
                                    <div class="form-section">
                                        <h4 class="form-section-title">
                                            <i class="fas fa-calendar-alt"></i>Detalles de la Cita
                                        </h4>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Médico</label>
                                                    <select class="form-select" name="doctor" id="doctor-select" onchange="updateAvailableSlots()">
                                                        <option value="">Seleccionar médico</option>
                                                        <option value="dr-martinez">Dr. Juan Martínez</option>
                                                        <option value="dra-fernandez">Dra. Fernanda Fernández</option>
                                                        <option value="dr-garcia">Dr. Carlos García</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Fecha de la cita</label>
                                                    <input type="date" class="form-control" name="appointment-date" id="appointment-date" onchange="updateAvailableSlots()">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Línea divisoria -->
                                        <hr class="my-4">
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Horarios disponibles</label>
                                            <div id="time-slots" class="d-flex flex-wrap gap-2">
                                                <p class="text-muted">Seleccione un médico y una fecha para ver los horarios disponibles</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Línea divisoria -->
                                    <hr class="my-4">
                                    
                                    <!-- Sección de Paciente -->
                                    <div class="form-section">
                                        <h4 class="form-section-title">
                                            <i class="fas fa-user"></i>Seleccionar Paciente
                                        </h4>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Tipo de paciente:</label>
                                            <div class="d-flex gap-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="patient-type" id="existing-patient" value="existing" checked onchange="togglePatientForm()">
                                                    <label class="form-check-label" for="existing-patient">
                                                        Paciente existente
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="patient-type" id="new-patient" value="new" onchange="togglePatientForm()">
                                                    <label class="form-check-label" for="new-patient">
                                                        Nuevo paciente
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Formulario para paciente existente -->
                                        <div id="existing-patient-section">
                                            <div class="mb-3">
                                                <label class="form-label">Buscar paciente existente:</label>
                                                <input type="text" class="form-control" id="patient-search" placeholder="Nombre del paciente..." onkeyup="filterPatients()">
                                            </div>
                                            
                                            <div id="patient-list" class="mb-3" style="max-height: 300px; overflow-y: auto;">
                                                ${samplePatients.map(patient => `
                                                    <div class="patient-card" onclick="selectPatient(${patient.id})">
                                                        <h6 class="mb-1">${patient.name}</h6>
                                                        <small class="text-muted">Tel: ${patient.phone} | Email: ${patient.email}</small>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                        
                                        <!-- Formulario para paciente nuevo -->
                                        <div id="new-patient-form" style="display: none;">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label">Nombre completo</label>
                                                        <input type="text" class="form-control" name="patient-name" required>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label">Teléfono</label>
                                                        <input type="tel" class="form-control" name="patient-phone" required>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label">Email</label>
                                                        <input type="email" class="form-control" name="patient-email">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label">Fecha de nacimiento</label>
                                                        <input type="date" class="form-control" name="patient-birthdate">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label">CURP</label>
                                                        <input type="text" class="form-control" name="curp">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label">Contacto de Emergencia</label>
                                                        <input type="tel" class="form-control" name="emergency-contact">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label">Género</label>
                                                        <select class="form-select" name="patient-gender" required>
                                                            <option value="">Seleccionar género</option>
                                                            <option value="masculino">Masculino</option>
                                                            <option value="femenino">Femenino</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label">Dirección</label>
                                                        <input type="text" class="form-control" name="address">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Línea divisoria -->
                                    <hr class="my-4">
                                    
                                    <!-- Motivo de la consulta -->
                                    <div class="form-section">
                                        <div class="mb-3">
                                            <label class="form-label">Motivo de la consulta</label>
                                            <textarea class="form-control" name="reason" rows="3" placeholder="Describa el motivo de la consulta..."></textarea>
                                        </div>
                                    </div>
                                    
                                    <!-- Botones de acción -->
                                    <div class="d-flex justify-content-between">
                                        <a href="#" onclick="loadPage('calendario')" class="btn btn-outline-secondary">
                                            <i class="fas fa-arrow-left me-2"></i>Volver al Calendario
                                        </a>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-2"></i>Agendar Cita
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        // Página de Gestión de Citas (unificada)
        function getCitasPage() {
            // Filtrar solo citas pendientes
            const citasPendientes = sampleAppointments.filter(cita => cita.status === 'pendiente');
            
            return `
                <section class="container mt-4">
                    <div class="row">
                        <div class="col-12">
                            <h1 class="section-title">Gestión de Citas</h1>
                            <p class="lead">Revisa, confirma o cancela las citas pendientes y gestiona el calendario.</p>
                        </div>
                    </div>
                    
                    <!-- Sección de Citas Pendientes -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4><i class="fas fa-clock me-2"></i>Citas Pendientes de Confirmación</h4>
                                </div>
                                <div class="card-body">
                                    ${citasPendientes.length === 0 ? `
                                        <div class="text-center py-5">
                                            <i class="fas fa-calendar-check text-muted" style="font-size: 4rem;"></i>
                                            <h4 class="text-muted mt-3">No hay citas pendientes</h4>
                                            <p class="text-muted">Todas las citas están confirmadas o han sido atendidas.</p>
                                            <a href="#" onclick="loadPage('agendarcita')" class="btn btn-primary">
                                                <i class="fas fa-plus me-2"></i>Agendar Nueva Cita
                                            </a>
                                        </div>
                                    ` : `
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Fecha y Hora</th>
                                                        <th>Paciente</th>
                                                        <th>Médico</th>
                                                        <th>Tipo</th>
                                                        <th>Contacto</th>
                                                        <th>Estado</th>
                                                        <th>Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${citasPendientes.map(cita => `
                                                        <tr>
                                                            <td>
                                                                <strong>${cita.start.toLocaleDateString('es-ES')}</strong><br>
                                                                <small>${cita.start.toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'})} - ${cita.end.toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'})}</small>
                                                            </td>
                                                            <td>
                                                                <strong>${cita.title.split(' - ')[0]}</strong>
                                                            </td>
                                                            <td>${cita.doctor}</td>
                                                            <td>
                                                                <span class="badge bg-light text-dark">${cita.type}</span>
                                                            </td>
                                                            <td>
                                                                <small>
                                                                    ${samplePatients.find(p => p.name.includes(cita.title.split(' - ')[0]))?.phone || 'N/A'}<br>
                                                                    ${samplePatients.find(p => p.name.includes(cita.title.split(' - ')[0]))?.email || 'N/A'}
                                                                </small>
                                                            </td>
                                                            <td>
                                                                <span class="badge bg-warning text-dark">Pendiente</span>
                                                            </td>
                                                            <td>
                                                                <div class="btn-group btn-group-sm">
                                                                    <button class="btn btn-success" onclick="confirmarCita(${cita.id})">
                                                                        <i class="fas fa-check me-1"></i>Confirmar
                                                                    </button>
                                                                    <button class="btn btn-danger" onclick="cancelarCita(${cita.id})">
                                                                        <i class="fas fa-times me-1"></i>Cancelar
                                                                    </button>
                                                                    <button class="btn btn-outline-primary" onclick="verDetallesCita(${cita.id})">
                                                                        <i class="fas fa-eye"></i>
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    `).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sección de Calendario -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h4><i class="fas fa-calendar-alt me-2"></i>Calendario de Citas</h4>
                                    <button class="btn btn-outline-primary btn-sm" id="toggle-calendar-btn" onclick="toggleCalendar()">
                                        <i class="fas fa-chevron-up me-1"></i>Ocultar Calendario
                                    </button>
                                </div>
                               <div class="card-body" id="calendar-section">
                                    <div class="row">
                                        <div class="col-lg-8">
                                            <div class="calendar-container">
                                                <div id="citas-calendar"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-lg-4">
                                            <div class="appointment-details">
                                                <h5><i class="fas fa-info-circle me-2"></i>Detalles de la Cita</h5>
                                                <div id="citas-appointment-detail-content">
                                                    <p class="text-muted">Selecciona una cita del calendario para ver los detalles.</p>
                                                </div>
                                                
                                                <div class="mt-4">
                                                    <h6><i class="fas fa-filter me-2"></i>Filtros</h6>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="citas-filter-confirmed" checked>
                                                        <label class="form-check-label" for="citas-filter-confirmed">
                                                            Confirmadas
                                                        </label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="citas-filter-pending" checked>
                                                        <label class="form-check-label" for="citas-filter-pending">
                                                            Pendientes
                                                        </label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="citas-filter-urgent" checked>
                                                        <label class="form-check-label" for="citas-filter-urgent">
                                                            Urgentes
                                                        </label>
                                                    </div>
                                                </div>
                                                
                                                <div class="mt-4">
                                                    <a href="#" onclick="loadPage('agendarcita')" class="btn btn-primary w-100">
                                                        <i class="fas fa-plus me-2"></i>Agendar Nueva Cita
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        // Página de Historial de Citas
        function getHistorialPage() {
            return `
                <section class="container mt-4">
                    <div class="row">
                        <div class="col-12">
                            <h1 class="section-title">Historial de Citas</h1>
                            <p class="lead">Revisa el historial de citas completadas y los ingresos por doctor.</p>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Seleccionar Doctor</label>
                            <select class="form-select" id="historial-doctor-filter" onchange="filterHistorial()">
                                <option value="">Todos los doctores</option>
                                <option value="Dr. Martínez">Dr. Martínez</option>
                                <option value="Dra. Fernández">Dra. Fernández</option>
                                <option value="Dr. García">Dr. García</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Seleccionar Fecha</label>
                            <input type="date" class="form-control" id="historial-date-filter" onchange="filterHistorial()">
                        </div>
                    </div>
                </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Paciente</th>
                                                    <th>Médico</th>
                                                    <th>Tipo de Consulta</th>
                                                    <th>Estado</th>
                                                    <th>Costo</th>
                                                </tr>
                                            </thead>
                                            <tbody id="historial-citas-body">
                                                ${appointmentHistory.map(cita => `
                                                    <tr>
                                                        <td>${cita.start.toLocaleDateString('es-ES')}</td>
                                                        <td>${cita.title.split(' - ')[0]}</td>
                                                        <td>${cita.doctor}</td>
                                                        <td>${cita.type}</td>
                                                        <td><span class="badge bg-success">Completada</span></td>
                                                        <td>$${cita.costo}</td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="mt-4 p-3 bg-light rounded">
                                        <h5>Resumen de Ingresos</h5>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <p><strong>Dr. Martínez:</strong> $<span id="ingreso-martinez">${calculateDoctorIncome('Dr. Martínez')}</span></p>
                                            </div>
                                            <div class="col-md-3">
                                                <p><strong>Dra. Fernández:</strong> $<span id="ingreso-fernandez">${calculateDoctorIncome('Dra. Fernández')}</span></p>
                                            </div>
                                            <div class="col-md-3">
                                                <p><strong>Dr. García:</strong> $<span id="ingreso-garcia">${calculateDoctorIncome('Dr. García')}</span></p>
                                            </div>
                                            <div class="col-md-3">
                                                <p><strong>Total General:</strong> $<span id="ingreso-total">${calculateTotalIncome()}</span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        // Página de Gestión de Pacientes
        function getPacientesPage() {
            return `
                <section class="container mt-4">
                    <div class="row">
                        <div class="col-12">
                            <h1 class="section-title">Gestión de Pacientes</h1>
                            <p class="lead">Administra la información de todos los pacientes del consultorio.</p>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control" id="search-pacientes" placeholder="Buscar paciente..." style="width: 300px;">
                                    <button class="btn btn-outline-primary">
                                        <i class="fas fa-search me-2"></i>Buscar
                                    </button>
                                </div>
                                <button class="btn btn-primary" onclick="loadPage('agendarcita')">
                                    <i class="fas fa-plus me-2"></i>Nuevo Paciente
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Nombre Completo</th>
                                                    <th>Teléfono</th>
                                                    <th>Email</th>
                                                    <th>Fecha Nacimiento</th>
                                                    <th>Historial</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tabla-pacientes">
                                                ${samplePatients.map(paciente => `
                                                    <tr>
                                                        <td>${paciente.id}</td>
                                                        <td>
                                                            <strong>${paciente.name}</strong>
                                                            ${paciente.alergias ? `<br><small class="text-danger"><i class="fas fa-exclamation-triangle"></i> Alergias: ${paciente.alergias}</small>` : ''}
                                                        </td>
                                                        <td>${paciente.phone}</td>
                                                        <td>${paciente.email}</td>
                                                        <td>${paciente.birthdate || 'No especificada'}</td>
                                                        <td>
                                                            <span class="badge bg-info">${paciente.citas || 0} citas</span>
                                                            ${paciente.ultimaCita ? `<br><small>Última: ${paciente.ultimaCita}</small>` : ''}
                                                        </td>
                                                        <td>
                                                            <div class="btn-group btn-group-sm">
                                                                <button class="btn btn-outline-primary" onclick="editarPaciente(${paciente.id})">
                                                                    <i class="fas fa-edit"></i>
                                                                </button>
                                                                <button class="btn btn-outline-info" onclick="verHistorial(${paciente.id})">
                                                                    <i class="fas fa-history"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        // Inicialización del calendario principal
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek',
                locale: 'es',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: sampleAppointments,
                eventClick: function(info) {
                    const appointment = info.event;
                    document.getElementById('appointment-detail-content').innerHTML = `
                        <div class="alert alert-info">
                            <h6>${appointment.title}</h6>
                            <p class="mb-1"><strong>Médico:</strong> ${appointment.extendedProps.doctor}</p>
                            <p class="mb-1"><strong>Tipo:</strong> ${appointment.extendedProps.type}</p>
                            <p class="mb-1"><strong>Fecha:</strong> ${appointment.start.toLocaleDateString('es-ES')}</p>
                            <p class="mb-1"><strong>Hora:</strong> ${appointment.start.toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'})} - ${appointment.end.toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'})}</p>
                            <p class="mb-0"><strong>Estado:</strong> <span class="badge ${appointment.extendedProps.status === 'confirmada' ? 'bg-success' : 'bg-warning'}">${appointment.extendedProps.status}</span></p>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-sm btn-outline-primary">Confirmar Cita</button>
                            <button class="btn btn-sm btn-outline-danger">Cancelar Cita</button>
                        </div>
                    `;
                }
            });
            calendar.render();
        }

        // Inicialización del calendario en gestión de citas
        function initCitasCalendar() {
            const calendarEl = document.getElementById('citas-calendar');
            if (!calendarEl) return;
            
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek',
                locale: 'es',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: sampleAppointments,
                eventClick: function(info) {
                    const appointment = info.event;
                    document.getElementById('citas-appointment-detail-content').innerHTML = `
                        <div class="alert alert-info">
                            <h6>${appointment.title}</h6>
                            <p class="mb-1"><strong>Médico:</strong> ${appointment.extendedProps.doctor}</p>
                            <p class="mb-1"><strong>Tipo:</strong> ${appointment.extendedProps.type}</p>
                            <p class="mb-1"><strong>Fecha:</strong> ${appointment.start.toLocaleDateString('es-ES')}</p>
                            <p class="mb-1"><strong>Hora:</strong> ${appointment.start.toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'})} - ${appointment.end.toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'})}</p>
                            <p class="mb-0"><strong>Estado:</strong> <span class="badge ${appointment.extendedProps.status === 'confirmada' ? 'bg-success' : 'bg-warning'}">${appointment.extendedProps.status}</span></p>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="confirmarCita(${appointment.id})">Confirmar Cita</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="cancelarCita(${appointment.id})">Cancelar Cita</button>
                        </div>
                    `;
                }
            });
            calendar.render();
        }

        // Función para mostrar/ocultar calendario en gestión de citas
        function toggleCalendar() {
            const calendarSection = document.getElementById('calendar-section');
            const toggleBtn = document.getElementById('toggle-calendar-btn');
            
            if (calendarSection.style.display === 'none') {
                calendarSection.style.display = 'block';
                toggleBtn.innerHTML = '<i class="fas fa-chevron-up me-1"></i>Ocultar Calendario';
                // Inicializar calendario si no está inicializado
                setTimeout(initCitasCalendar, 100);
            } else {
                calendarSection.style.display = 'none';
                toggleBtn.innerHTML = '<i class="fas fa-chevron-down me-1"></i>Desplegar Calendario';
            }
        }

        // Funciones para cálculos de ingresos
        function calculateDoctorIncome(doctorName) {
            return appointmentHistory
                .filter(cita => cita.doctor === doctorName)
                .reduce((total, cita) => total + cita.costo, 0);
        }

        function calculateTotalIncome() {
            return appointmentHistory
                .reduce((total, cita) => total + cita.costo, 0);
        }

        // Función para filtrar el historial
function filterHistorial() {
    const doctorFilter = document.getElementById('historial-doctor-filter').value;
    const dateFilter = document.getElementById('historial-date-filter').value;
    
    let filteredCitas = appointmentHistory;
    
    // Filtrar por doctor
    if (doctorFilter) {
        filteredCitas = filteredCitas.filter(cita => cita.doctor === doctorFilter);
    }
    
    // Filtrar por fecha
    if (dateFilter) {
        filteredCitas = filteredCitas.filter(cita => {
            const citaDate = new Date(cita.start).toISOString().split('T')[0];
            return citaDate === dateFilter;
        });
    }
    
    // Actualizar la tabla
    const tbody = document.getElementById('historial-citas-body');
    tbody.innerHTML = filteredCitas.map(cita => `
        <tr>
            <td>${cita.start.toLocaleDateString('es-ES')}</td>
            <td>${cita.title.split(' - ')[0]}</td>
            <td>${cita.doctor}</td>
            <td>${cita.type}</td>
            <td><span class="badge bg-success">Completada</span></td>
            <td>$${cita.costo}</td>
        </tr>
    `).join('');
    
    // Actualizar resumen de ingresos
    updateIncomeSummary(filteredCitas);
}

    // Función para actualizar el resumen de ingresos
    function updateIncomeSummary(citasFiltradas) {
        const doctorMartinez = citasFiltradas
            .filter(cita => cita.doctor === 'Dr. Martínez')
            .reduce((total, cita) => total + cita.costo, 0);
        
        const doctorFernandez = citasFiltradas
            .filter(cita => cita.doctor === 'Dra. Fernández')
            .reduce((total, cita) => total + cita.costo, 0);

            // Dentro de updateIncomeSummary(), después de calcular doctorFernandez, agrega:
            const doctorGarcia = citasFiltradas
                .filter(cita => cita.doctor === 'Dr. García')
                .reduce((total, cita) => total + cita.costo, 0);
        
        const totalGeneral = citasFiltradas
            .reduce((total, cita) => total + cita.costo, 0);
        
        // Actualizar los elementos en el DOM - SOLO el número, sin el $
        document.getElementById('ingreso-martinez').textContent = doctorMartinez;
        document.getElementById('ingreso-fernandez').textContent = doctorFernandez;
        document.getElementById('ingreso-garcia').textContent = doctorGarcia;
        document.getElementById('ingreso-total').textContent = totalGeneral;
    }

        // El resto de las funciones permanecen igual...
        // (updateAvailableSlots, togglePatientForm, filterPatients, selectPatient, selectTimeSlot, etc.)

        // Nueva función para actualizar horarios disponibles según doctor y fecha
        function updateAvailableSlots() {
            const doctorSelect = document.getElementById('doctor-select');
            const dateInput = document.getElementById('appointment-date');
            const timeSlotsContainer = document.getElementById('time-slots');
            
            // Si no hay médico o fecha seleccionados, mostrar mensaje inicial
            if (!doctorSelect.value || !dateInput.value) {
                timeSlotsContainer.innerHTML = '<p class="text-muted">Seleccione un médico y una fecha para ver los horarios disponibles</p>';
                return;
            }
            
            const doctor = doctorSelect.value;
            const selectedDate = new Date(dateInput.value);
            const today = new Date();
            const todayDateOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const selectedDateOnly = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), selectedDate.getDate());
            
            // Validar que la fecha no sea anterior a hoy
            if (selectedDateOnly < todayDateOnly) {
                timeSlotsContainer.innerHTML = '<p class="text-danger">No se pueden agendar citas en fechas pasadas</p>';
                return;
            }
            
            // Generar horarios diferentes según el doctor seleccionado
            let startHour, endHour;
            
            switch(doctor) {
                case 'dr-martinez':
                    startHour = 8;  // Dr. Martínez trabaja de 8am a 3pm
                    endHour = 15;
                    break;
                case 'dra-fernandez':
                    startHour = 10; // Dra. Fernández trabaja de 10am a 5pm
                    endHour = 17;
                    break;
                case 'dr-garcia':
                    startHour = 9;  // Dr. García trabaja de 9am a 4pm
                    endHour = 16;
                    break;
                default:
                    startHour = 8;
                    endHour = 17;
            }
            
            const slots = [];
            const occupiedSlots = getOccupiedSlots(doctor, dateInput.value, selectedDateOnly.getTime() === todayDateOnly.getTime());
            
            // Si es hoy, calcular la hora actual para no mostrar horarios pasados
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            for (let hour = startHour; hour <= endHour; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const slotId = `${dateInput.value}-${timeString}`;
                    const isOccupied = occupiedSlots.includes(slotId);
                    
                    // Si es hoy, verificar si el horario ya pasó
                    const isPastTime = selectedDateOnly.getTime() === todayDateOnly.getTime() && 
                                      (hour < currentHour || (hour === currentHour && minute < currentMinute));
                    
                    const isAvailable = !isOccupied && !isPastTime;
                    
                    slots.push(`
                        <div class="time-slot ${isAvailable ? 'available' : 'occupied'}" 
                             ${isAvailable ? `onclick="selectTimeSlot(this, '${timeString}')"` : ''}
                             data-time="${timeString}">
                            ${timeString}
                            ${isOccupied ? '<small class="d-block">Ocupado</small>' : ''}
                            ${isPastTime ? '<small class="d-block">Pasado</small>' : ''}
                        </div>
                    `);
                }
            }
            
            const availableSlots = slots.filter(slot => !slot.includes('occupied'));
            timeSlotsContainer.innerHTML = availableSlots.length > 0 ? slots.join('') : '<p class="text-muted">No hay horarios disponibles para esta fecha</p>';
        }

        // Función para obtener horarios ocupados (simulada)
        function getOccupiedSlots(doctor, date) {
            // Simular horarios ocupados - en una aplicación real esto vendría de una base de datos
            const occupied = [];
            
            // Simular algunos horarios ocupados aleatoriamente
            for (let i = 0; i < 3; i++) {
                const randomHour = Math.floor(Math.random() * 8) + 8; // Entre 8am y 4pm
                const randomMinute = Math.random() > 0.5 ? 0 : 30;
                const timeString = `${randomHour.toString().padStart(2, '0')}:${randomMinute.toString().padStart(2, '0')}`;
                occupied.push(`${date}-${timeString}`);
            }
            
            return occupied;
        }

        // Función para alternar entre formularios de paciente
        function togglePatientForm() {
            const existingPatientSection = document.getElementById('existing-patient-section');
            const newPatientForm = document.getElementById('new-patient-form');
            const patientType = document.querySelector('input[name="patient-type"]:checked').value;
            
            if (patientType === 'existing') {
                existingPatientSection.style.display = 'block';
                newPatientForm.style.display = 'none';
            } else {
                existingPatientSection.style.display = 'none';
                newPatientForm.style.display = 'block';
            }
        }

        // Función para filtrar pacientes en la búsqueda
        function filterPatients() {
            const searchTerm = document.getElementById('patient-search').value.toLowerCase();
            const patientCards = document.querySelectorAll('.patient-card');
            let hasResults = false;
            
            patientCards.forEach(card => {
                const patientName = card.querySelector('h6').textContent.toLowerCase();
                if (patientName.includes(searchTerm)) {
                    card.style.display = 'block';
                    hasResults = true;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Mostrar mensaje si no hay resultados
            const patientList = document.getElementById('patient-list');
            if (!hasResults) {
                if (!patientList.querySelector('.no-results')) {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-results text-muted text-center py-3';
                    noResults.innerHTML = '<i class="fas fa-search me-2"></i>No se encontraron pacientes';
                    patientList.appendChild(noResults);
                }
            } else {
                const noResults = patientList.querySelector('.no-results');
                if (noResults) {
                    noResults.remove();
                }
            }
        }

        // Función para seleccionar paciente (actualizada)
        function selectPatient(patientId) {
            document.querySelectorAll('.patient-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            const selectedCard = event.target.closest('.patient-card');
            selectedCard.classList.add('selected');
            
            // Aquí podrías cargar la información del paciente seleccionado si es necesario
            console.log('Paciente seleccionado:', patientId);
        }

        // Función para seleccionar horario (actualizada)
        function selectTimeSlot(element, time) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // Guardar el horario seleccionado en el formulario
            const selectedTimeInput = document.getElementById('selected-time');
            if (!selectedTimeInput) {
                // Crear input hidden si no existe
                const timeInput = document.createElement('input');
                timeInput.type = 'hidden';
                timeInput.id = 'selected-time';
                timeInput.name = 'selected-time';
                timeInput.value = time;
                document.getElementById('appointment-form').appendChild(timeInput);
            } else {
                selectedTimeInput.value = time;
            }
            
            console.log('Horario seleccionado:', time);
        }

        // Actualizar la función initAppointmentForm
        function initAppointmentForm() {
            // Toggle formulario de paciente
            document.querySelectorAll('input[name="patient-type"]').forEach(radio => {
                radio.addEventListener('change', togglePatientForm);
            });
            
            // Inicializar el estado del formulario de paciente
            togglePatientForm();
            
            // Establecer fecha mínima como hoy y fecha por defecto como hoy
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('appointment-date');
            dateInput.setAttribute('min', today);
            dateInput.value = today; // Establecer hoy como fecha por defecto
            
            // Limpiar horarios inicialmente
            document.getElementById('time-slots').innerHTML = '<p class="text-muted">Seleccione un médico para ver los horarios disponibles</p>';
            
            // Si hay un médico seleccionado por defecto, actualizar horarios
            const doctorSelect = document.getElementById('doctor-select');
            if (doctorSelect.value) {
                setTimeout(() => updateAvailableSlots(), 100);
            }
            
            // Manejar envío del formulario
            document.getElementById('appointment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validaciones
                const doctorSelect = document.getElementById('doctor-select');
                const selectedTime = document.querySelector('.time-slot.selected');
                const patientType = document.querySelector('input[name="patient-type"]:checked').value;
                
                if (!doctorSelect.value) {
                    alert('Por favor seleccione un médico');
                    return;
                }
                
                if (!selectedTime) {
                    alert('Por favor seleccione un horario disponible');
                    return;
                }
                
                if (patientType === 'existing') {
                    const selectedPatient = document.querySelector('.patient-card.selected');
                    if (!selectedPatient) {
                        alert('Por favor seleccione un paciente de la lista');
                        return;
                    }
                }
                
                // Validar formulario de nuevo paciente si es necesario
                if (patientType === 'new') {
                    const patientName = document.querySelector('input[name="patient-name"]').value;
                    const patientPhone = document.querySelector('input[name="patient-phone"]').value;
                    
                    if (!patientName || !patientPhone) {
                        alert('Por favor complete los campos obligatorios del nuevo paciente');
                        return;
                    }
                }
                
                // Simular agendado exitoso
                const doctorName = doctorSelect.options[doctorSelect.selectedIndex].text;
                const selectedDate = document.getElementById('appointment-date').value;
                const selectedTimeValue = document.getElementById('selected-time').value;
                
                alert(`¡Cita agendada exitosamente!\n\nMédico: ${doctorName}\nFecha: ${selectedDate}\nHora: ${selectedTimeValue}`);
                loadPage('calendario');
            });
        }

        // Cargar página inicial al cargar el documento
        document.addEventListener('DOMContentLoaded', function() {
            loadPage('index');
            
            // Actualizar fecha actual
            function updateCurrentDate() {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.querySelectorAll('.current-date').forEach(element => {
                    element.textContent = now.toLocaleDateString('es-ES', options);
                });
            }
            
            updateCurrentDate();
        });

        // Funciones para gestión de pacientes
        function editarPaciente(id) {
            alert(`Editando paciente con ID: ${id}`);
        }

        function verHistorial(id) {
            alert(`Viendo historial del paciente con ID: ${id}`);
        }

        function eliminarPaciente(id) {
            if (confirm('¿Está seguro de que desea eliminar este paciente?')) {
                alert(`Paciente con ID: ${id} eliminado`);
            }
        }

        // Funciones para gestión de citas
        function confirmarCita(id) {
            if (confirm('¿Confirmar esta cita?')) {
                alert(`Cita con ID: ${id} confirmada`);
                // Aquí actualizarías el estado de la cita
            }
        }

        function cancelarCita(id) {
            const motivo = prompt('Ingrese el motivo de la cancelación:');
            if (motivo !== null) {
                alert(`Cita con ID: ${id} cancelada. Motivo: ${motivo}`);
                // Aquí actualizarías el estado de la cita
            }
        }

        function verDetallesCita(id) {
            alert(`Viendo detalles de la cita con ID: ${id}`);
        }
    </script>
</body>
</html>